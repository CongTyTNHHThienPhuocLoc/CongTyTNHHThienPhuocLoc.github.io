<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        body {
            background-color: #f8f9fa;
        }

        .container {
            text-align: center;
            margin-top: 50px;
        }

        .red-text {
            color: red;
        }

        .temperature-box {
            background-color: #d1ecf1;
            padding: 10px;
            margin-top: 20px;
            width: 180px;
        }

        .action-buttons {
            margin-top: 20px;
        }

        .custom-border {
            border: 1px solid #dee2e6;
            border-radius: 10px;
            margin: 10px;
            padding: 10px;
        }
        .btn-custom{
            font-size: 1em;
        }
        .disabled-custom{
            color: var(--bs-btn-disabled-color);
            cursor: pointer;  
            background-color: var(--bs-btn-disabled-bg);
            border-color: var(--bs-btn-disabled-border-color);
            opacity: var(--bs-btn-disabled-opacity);
        }
        .container-loading{
            background-color: white;
            width: 100vw;
            height: 100vh;
            margin: unset;
            display: flex;
        }


    </style>
    <title>THIẾT BỊ BÁO CHÁY 8 VÙNG</title>
</head>

<body>
    <div class="container-loading" >
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
        style="margin: auto;    margin-top: 25vh; background: rgb(255, 255, 255); display: block; shape-rendering: auto;" width="200px" height="200px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">
            <circle cx="50" cy="50" r="0" fill="none" stroke="#e90c59" stroke-width="2">
              <animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="0s"></animate>
              <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="0s"></animate>
            </circle><circle cx="50" cy="50" r="0" fill="none" stroke="#46dff0" stroke-width="2">
              <animate attributeName="r" repeatCount="indefinite" dur="1s" values="0;40" keyTimes="0;1" keySplines="0 0.2 0.8 1" calcMode="spline" begin="-0.5s"></animate>
              <animate attributeName="opacity" repeatCount="indefinite" dur="1s" values="1;0" keyTimes="0;1" keySplines="0.2 0 0.8 1" calcMode="spline" begin="-0.5s"></animate>
            </circle>
            <!-- [ldio] generated by https://loading.io/ -->
        </svg>
    </div>
    <div class="container container-content" style="display: none;">
        <div class="custom-border">
            <h1 style="font-size: 1em;">CÔNG TY TNHH THIÊN PHƯỚC LỘC</h1>
        </div>
        <p class="red-text" class="font-size: small;font-weight: bold;">THIẾT BỊ BÁO CHÁY 8 VÙNG</p>
        <div class="d-flex">
            <div class="custom-border temperature-box mx-auto" id="temperature">NHIỆT ĐỘ: N/A độ C</div>
        </div>
       
        <div class="row action-buttons ">
            <div class="col-6">
                <button type="button" class="btn btn-primary btn-lg btn-block" id="alert" text-title="Cảnh báo"  onclick="toggleButton(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="14" viewBox="0 0 448 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M224 0c-17.7 0-32 14.3-32 32V51.2C119 66 64 130.6 64 208v18.8c0 47-17.3 92.4-48.5 127.6l-7.4 8.3c-8.4 9.4-10.4 22.9-5.3 34.4S19.4 416 32 416H416c12.6 0 24-7.4 29.2-18.9s3.1-25-5.3-34.4l-7.4-8.3C401.3 319.2 384 273.9 384 226.8V208c0-77.4-55-142-128-156.8V32c0-17.7-14.3-32-32-32zm45.3 493.3c12-12 18.7-28.3 18.7-45.3H224 160c0 17 6.7 33.3 18.7 45.3s28.3 18.7 45.3 18.7s33.3-6.7 45.3-18.7z"/></svg>
                </button>
            </div>
            <div class="col-6">
                <button type="button" class="btn btn-danger btn-lg btn-block" id="sos" text-title="SOS"  onclick="toggleButton(this)">
                    <svg xmlns="http://www.w3.org/2000/svg" height="16" width="16" viewBox="0 0 512 512"><!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.--><path d="M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z"/></svg>
                </button>
            </div>
        </div>
        <div class="row action-buttons d-flex">
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area1" text-title="Vùng 1" onclick="toggleButton(this)">Vùng 1</button>
            </div>
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area2" text-title="Vùng 2" onclick="toggleButton(this)">Vùng 2</button>
            </div>
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area3" text-title="Vùng 3" onclick="toggleButton(this)">Vùng 3</button>
            </div>
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area4" text-title="Vùng 4" onclick="toggleButton(this)">Vùng 4</button>
            </div>
             <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area5" text-title="Vùng 5" onclick="toggleButton(this)">Vùng 5</button>
            </div>
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area6" text-title="Vùng 6" onclick="toggleButton(this)">Vùng 6</button>
            </div>
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area7" text-title="Vùng 7" onclick="toggleButton(this)">Vùng 7</button>
            </div>
            <div class="col-md-3 col-3 mb-2">
                <button type="button" class="btn btn-primary btn-lg btn-block btn-custom" id="area8" text-title="Vùng 8" onclick="toggleButton(this)">Vùng 8</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    
   <script>

        const firebaseConfig = {
            apiKey: "AIzaSyBckkNHIvMoIgxIHt_3HOTlMcso2V2uN_Q",
            authDomain: "database-app-android-4c845.firebaseapp.com",
            databaseURL: "https://database-app-android-4c845-default-rtdb.firebaseio.com",
            projectId: "database-app-android-4c845",
            storageBucket: "database-app-android-4c845.appspot.com",
            messagingSenderId: "596263588445",
            appId: "1:596263588445:web:ef8e05eee6120f71eeb3b4"
        };
        // Khởi tạo Firebase
        firebase.initializeApp(firebaseConfig);

        // Lấy reference đến Firebase Realtime Database
        var database = firebase.database();

        var temperatureKey = "setting";
        database.ref(temperatureKey).on('value', function(snapshot) {
            var data = snapshot.val();

            console.log('data', data);
            applyButtonStates(data);
        });

         $(document).ready(function () {
            // Hiển thị loading khi trang được tải
            var containerLoading        = $('.container-loading');
            var containerContent        = $('.container-content');
    
            // Thực hiện gọi API bằng AJAX
            setTimeout(() => {
                $.ajax({
                url: 'https://database-app-android-4c845-default-rtdb.firebaseio.com/setting.json',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
            
                    applyButtonStates(data);
    
                    // Ẩn loading khi dữ liệu đã được tải
                    containerLoading.hide();
                    containerContent.show();
                },
                error: function (error) {
                    // Xử lý lỗi
                    console.error('Error:', error);
                    Swal.fire({
                        position: "center",
                        icon: "warning",
                        title: "Kết nối database thất bại, vui lòng thử lại !",
                        showConfirmButton: false,
                        timer: 1500
                    });
    
                    // Ẩn loading khi có lỗi xảy ra
                    containerLoading.hide();
                    containerContent.show();
                }
            });
            }, 1000);
        });
        function toggleButton(button) {
            // Kiểm tra xem button có lớp disabled không
            var isDisabled = button.classList.contains('disabled-custom');
            var id = $('#' + button.id);
            var message = "Hệ thống đang bảo trì, vui lòng thử lại sau!";

            // bật 
            if (!isDisabled) {
                button.classList.add('disabled-custom');
                id.attr("value", true);
                message = "Bật cảnh báo " + id.attr("text-title") + " thành công";
            } else {
                button.classList.remove('disabled-custom');
                id.attr("value", false);
                message = "Tắt cảnh báo " + id.attr("text-title") + " thành công";
            }
            getAllValuesAndCallApi(message);
        }
        function applyButtonStates(data) {
            // Duyệt qua các key trong data và áp dụng trạng thái lên các button
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    var buttonId = '#' + key;
                    var button = $(buttonId);

                    // Kiểm tra giá trị của key và thêm/loại bỏ lớp disabled-custom
                    if (data[key] === "true") {
                        button.addClass('disabled-custom');
                    } else {
                        button.removeClass('disabled-custom');
                    }
                    if(key === "temperature"){
                        $('#temperature').html(`NHIỆT ĐỘ: ${data.temperature} độ C`);
                    }
                    $('#' + key).attr('value', data[key]);
                }
            }
        }
        function getAllValues() {
            var values = {};

            // Duyệt qua mảng các ID và lấy giá trị từ các thẻ tương ứng
            var ids = [
                'area1', 'area2', 'area3', 'area4', 'area5',
                'area6', 'area7', 'area8', 'sos', 'alert', 'temperature'
            ];

            for (var i = 0; i < ids.length; i++) {
                var id = ids[i];
                var value = $('#' + id).attr("value");
                values[id] = value;
            }

            return values;
        }
        function getAllValuesAndCallApi(message) {
            // Lấy giá trị từ tất cả các thẻ button
            var values = getAllValues();

            // Gọi API để cập nhật dữ liệu trên server
            $.ajax({
                url: 'https://database-app-android-4c845-default-rtdb.firebaseio.com/setting.json',
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(values),
                success: function (response) {
                    Swal.fire({
                        position: "center",
                        icon: "success",
                        title: message,
                        showConfirmButton: false,
                        timer: 1500
                    });
                },
                error: function (error) {
                    console.error('Error updating data:', error);
                    Swal.fire({
                        position: "center",
                        icon: "warning",
                        title: JSON.stringify(error),
                        showConfirmButton: false,
                        timer: 1500
                    });
                }
            });
        }
       
    </script>
</body>

</html>
